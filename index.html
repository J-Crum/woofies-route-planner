<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Woofies Route Planner ‚Äî Castle Rock, CO</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCU58Cp-nHcbGwj50y6DYog-5pQN0w5QKs&libraries=places"></script>
<style>
  :root {
    --north: #C62828;
    --north-light: #FCEAE9;
    --north-mid: #E53935;
    --east: #2E7D32;
    --east-light: #E6F4EA;
    --east-mid: #43A047;
    --south: #1565C0;
    --south-light: #E8F0FE;
    --south-mid: #1E88E5;
    --castle-rock: #D46A00;
    --castle-rock-light: #FEF7E0;
    --castle-rock-mid: #FFA000;
    --bg: #f4f5f7;
    --panel: #ffffff;
    --panel-border: #e0e3e8;
    --text: #1a1a2e;
    --text-dim: #6b7280;
    --accent: #e94560;
    --paw: #d4830a;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    height: 100vh;
    overflow: hidden;
    display: flex;
  }

  /* Left Sidebar */
  .sidebar {
    width: 380px;
    min-width: 380px;
    background: var(--panel);
    border-right: 1px solid var(--panel-border);
    box-shadow: 2px 0 12px rgba(0,0,0,0.06);
    display: flex;
    flex-direction: column;
    height: 100vh;
    z-index: 1000;
  }

  .sidebar-header {
    padding: 20px 24px 16px;
    border-bottom: 1px solid var(--panel-border);
    background: linear-gradient(135deg, #f8f9fb 0%, #ffffff 100%);
  }

  .logo-row {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 4px;
  }

  .logo-icon {
    width: 44px;
    height: 44px;
    background: var(--paw);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    box-shadow: 0 4px 12px rgba(212, 131, 10, 0.25);
  }

  .logo-text {
    font-family: 'Fredoka', sans-serif;
    font-size: 26px;
    font-weight: 700;
    color: var(--paw);
    letter-spacing: -0.5px;
  }

  .logo-sub {
    font-size: 12px;
    color: var(--text-dim);
    margin-left: 56px;
    margin-top: -2px;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .sidebar-content {
    flex: 1;
    overflow-y: auto;
    padding: 0;
  }

  .sidebar-content::-webkit-scrollbar { width: 6px; }
  .sidebar-content::-webkit-scrollbar-track { background: transparent; }
  .sidebar-content::-webkit-scrollbar-thumb { background: var(--panel-border); border-radius: 3px; }

  /* Search Section */
  .search-section {
    padding: 20px 24px;
    border-bottom: 1px solid var(--panel-border);
  }

  .section-title {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-dim);
    margin-bottom: 12px;
    font-weight: 600;
  }

  .search-box {
    position: relative;
  }

  .search-box input {
    width: 100%;
    padding: 12px 16px 12px 42px;
    background: var(--bg);
    border: 1px solid var(--panel-border);
    border-radius: 10px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
  }

  .search-box input:focus {
    border-color: var(--paw);
    box-shadow: 0 0 0 3px rgba(245, 197, 66, 0.1);
  }

  .search-box input::placeholder { color: var(--text-dim); }

  .search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-dim);
    font-size: 16px;
  }

  .search-btn {
    width: 100%;
    margin-top: 10px;
    padding: 11px;
    background: var(--paw);
    color: var(--bg);
    border: none;
    border-radius: 10px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.3px;
  }

  .search-btn:hover { background: #e6b632; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(245, 197, 66, 0.3); }

  /* Result Card */
  .result-card {
    margin-top: 14px;
    padding: 14px 16px;
    border-radius: 10px;
    display: none;
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .result-card.show { display: block; }

  .result-region {
    font-family: 'Fredoka', sans-serif;
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 4px;
  }

  .result-detail {
    font-size: 13px;
    opacity: 0.85;
    line-height: 1.5;
  }

  .result-card.north { background: rgba(217, 48, 37, 0.15); border: 1px solid rgba(217, 48, 37, 0.3); }
  .result-card.north .result-region { color: var(--north-mid); }
  .result-card.east { background: rgba(30, 142, 62, 0.15); border: 1px solid rgba(30, 142, 62, 0.3); }
  .result-card.east .result-region { color: var(--east-mid); }
  .result-card.south { background: rgba(26, 115, 232, 0.15); border: 1px solid rgba(26, 115, 232, 0.3); }
  .result-card.south .result-region { color: var(--south-mid); }
  .result-card.castle-rock { background: rgba(249, 171, 0, 0.15); border: 1px solid rgba(249, 171, 0, 0.3); }
  .result-card.castle-rock .result-region { color: var(--castle-rock-mid); }

  /* Legend */
  .legend-section {
    padding: 20px 24px;
    border-bottom: 1px solid var(--panel-border);
  }

  .legend-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 8px;
    background: var(--bg);
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid transparent;
  }

  .legend-item:hover { border-color: var(--panel-border); }
  .legend-item.active { border-color: var(--paw); }

  .legend-dot {
    width: 14px;
    height: 14px;
    border-radius: 4px;
    flex-shrink: 0;
  }

  .legend-label {
    font-size: 13px;
    font-weight: 500;
  }

  .legend-count {
    font-size: 11px;
    color: var(--text-dim);
  }

  /* Rings Legend */
  .rings-legend {
    padding: 16px 24px;
    border-bottom: 1px solid var(--panel-border);
  }

  .rings-row {
    display: flex;
    gap: 6px;
    align-items: center;
    flex-wrap: wrap;
    margin-top: 8px;
  }

  .ring-chip {
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid rgba(255, 255, 255, 0.12);
    color: var(--text);
  }

  .ring-chip:nth-child(2) { opacity: 0.9; }
  .ring-chip:nth-child(3) { opacity: 0.8; }
  .ring-chip:nth-child(4) { opacity: 0.7; }
  .ring-chip:nth-child(5) { opacity: 0.6; }
  .ring-chip:nth-child(6) { opacity: 0.5; }

  /* Neighborhoods List */
  .neighborhoods-section {
    padding: 20px 24px;
  }

  .neighborhood-filter {
    width: 100%;
    padding: 10px 14px;
    background: var(--bg);
    border: 1px solid var(--panel-border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    outline: none;
    margin-bottom: 12px;
  }

  .neighborhood-filter:focus { border-color: var(--paw); }

  .neighborhood-list {
    max-height: 300px;
    overflow-y: auto;
  }

  .neighborhood-list::-webkit-scrollbar { width: 5px; }
  .neighborhood-list::-webkit-scrollbar-track { background: transparent; }
  .neighborhood-list::-webkit-scrollbar-thumb { background: var(--panel-border); border-radius: 3px; }

  .neighborhood-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.15s;
    font-size: 13px;
  }

  .neighborhood-item:hover { background: var(--bg); }

  .neighborhood-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .neighborhood-name { flex: 1; }

  .neighborhood-dist {
    font-size: 11px;
    color: var(--text-dim);
    white-space: nowrap;
  }

  /* Stops Panel */
  .stops-section {
    padding: 20px 24px;
    border-bottom: 1px solid var(--panel-border);
  }

  .stops-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-top: 8px;
    max-height: 180px;
    overflow-y: auto;
  }

  .stop-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    background: var(--bg);
    border-radius: 8px;
    font-size: 13px;
  }

  .stop-num {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    color: var(--bg);
    flex-shrink: 0;
  }

  .stop-info { flex: 1; }
  .stop-addr { font-size: 12px; color: var(--text-dim); }

  .stop-remove {
    background: none;
    border: none;
    color: var(--text-dim);
    cursor: pointer;
    font-size: 16px;
    padding: 2px 6px;
    border-radius: 4px;
    transition: all 0.15s;
  }

  .stop-remove:hover { color: var(--accent); background: rgba(233, 69, 96, 0.1); }

  .clear-stops-btn {
    margin-top: 8px;
    padding: 8px;
    width: 100%;
    background: rgba(233, 69, 96, 0.1);
    border: 1px solid rgba(233, 69, 96, 0.2);
    border-radius: 8px;
    color: var(--accent);
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }

  .clear-stops-btn:hover { background: rgba(233, 69, 96, 0.2); }

  .no-stops {
    font-size: 12px;
    color: var(--text-dim);
    text-align: center;
    padding: 16px;
    font-style: italic;
  }

  /* Map Area */
  .map-container {
    flex: 1;
    position: relative;
  }

  #map {
    width: 100%;
    height: 100%;
  }

  /* Map Controls Overlay */
  .map-controls {
    position: absolute;
    top: 16px;
    right: 16px;
    z-index: 999;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .map-ctrl-btn {
    width: 40px;
    height: 40px;
    background: var(--panel);
    border: 1px solid var(--panel-border);
    border-radius: 10px;
    color: var(--text);
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .map-ctrl-btn:hover { background: var(--bg); border-color: var(--paw); }
  .map-ctrl-btn.active { background: var(--paw); color: var(--bg); border-color: var(--paw); }

  /* Info tooltip on map */
  .leaflet-popup-content-wrapper {
    background: #ffffff !important;
    color: var(--text) !important;
    border-radius: 10px !important;
    border: 1px solid var(--panel-border) !important;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12) !important;
  }

  .leaflet-popup-tip { background: #ffffff !important; }

  .leaflet-popup-content {
    margin: 12px 16px !important;
    font-family: 'DM Sans', sans-serif !important;
    font-size: 13px !important;
    line-height: 1.5 !important;
  }

  .popup-title {
    font-family: 'Fredoka', sans-serif;
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 4px;
  }

  .popup-region {
    font-size: 12px;
    padding: 2px 8px;
    border-radius: 4px;
    display: inline-block;
    margin-bottom: 4px;
    font-weight: 500;
  }

  .popup-dist { font-size: 12px; color: var(--text-dim); }

  .popup-add-btn {
    margin-top: 8px;
    padding: 6px 12px;
    background: var(--paw);
    color: var(--bg);
    border: none;
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    width: 100%;
    transition: background 0.2s;
  }

  .popup-add-btn:hover { background: #e6b632; }

  /* Loading state */
  .loading-overlay {
    position: absolute;
    inset: 0;
    background: rgba(244, 245, 247, 0.92);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 0.5s;
  }

  .loading-overlay.hidden { opacity: 0; pointer-events: none; }

  .loading-spinner {
    text-align: center;
  }

  .loading-spinner .paw {
    font-size: 48px;
    animation: bounce 1s ease infinite;
  }

  .loading-spinner p {
    margin-top: 12px;
    color: var(--text-dim);
    font-size: 14px;
  }

  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-12px); }
  }

  /* HQ Marker */
  .hq-marker {
    background: var(--paw);
    border: 3px solid #fff;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 0 20px rgba(245, 197, 66, 0.4);
  }

  .leaflet-control-zoom { display: none !important; }

  /* Toggle sidebar on mobile */
  .sidebar-toggle {
    display: none;
    position: absolute;
    top: 16px;
    left: 16px;
    z-index: 1001;
    width: 44px;
    height: 44px;
    background: var(--panel);
    border: 1px solid var(--panel-border);
    border-radius: 10px;
    color: var(--paw);
    font-size: 22px;
    cursor: pointer;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  @media (max-width: 768px) {
    .sidebar { position: absolute; left: -380px; z-index: 1001; transition: left 0.3s; height: 100vh; }
    .sidebar.open { left: 0; }
    .sidebar-toggle { display: flex; }
  }

  /* Stats bar */
  .stats-bar {
    position: absolute;
    bottom: 16px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 999;
    display: flex;
    gap: 12px;
    background: var(--panel);
    border: 1px solid var(--panel-border);
    border-radius: 12px;
    padding: 12px 20px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
  }

  .stat-item {
    text-align: center;
  }

  .stat-value {
    font-family: 'Fredoka', sans-serif;
    font-size: 20px;
    font-weight: 700;
    color: var(--paw);
  }

  .stat-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-dim);
  }

  .stat-divider {
    width: 1px;
    background: var(--panel-border);
  }
</style>
</head>
<body>

<button class="sidebar-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">‚ò∞</button>

<aside class="sidebar">
  <div class="sidebar-header">
    <div class="logo-row">
      <div class="logo-icon">üêæ</div>
      <div class="logo-text">Woofies</div>
    </div>
    <div class="logo-sub">Mobile Grooming Route Planner</div>
  </div>

  <div class="sidebar-content">
    <!-- Address Lookup -->
    <div class="search-section">
      <div class="section-title">üìç Address Lookup</div>
      <div class="search-box">
        <span class="search-icon">‚åï</span>
        <input type="text" id="addressInput" placeholder="Enter address (e.g., 123 Main St, Parker)" onkeydown="if(event.key==='Enter')lookupAddress()">
      </div>
      <button class="search-btn" onclick="lookupAddress()">Find Region & Distance</button>
      <div class="result-card" id="resultCard">
        <div class="result-region" id="resultRegion"></div>
        <div class="result-detail" id="resultDetail"></div>
      </div>
    </div>

    <!-- Route Stops -->
    <div class="stops-section">
      <div class="section-title">üöê Today's Route Stops</div>
      <div class="stops-list" id="stopsList">
        <div class="no-stops" id="noStops">Click neighborhoods or search addresses to build a route</div>
      </div>
      <button class="clear-stops-btn" id="clearBtn" onclick="clearStops()" style="display:none">Clear All Stops</button>
    </div>

    <!-- Region Legend -->
    <div class="legend-section">
      <div class="section-title">üó∫Ô∏è Service Regions</div>
      <div class="legend-grid">
        <div class="legend-item active" data-region="north" onclick="toggleRegion('north', this)">
          <div class="legend-dot" style="background:var(--north)"></div>
          <div>
            <div class="legend-label">North</div>
            <div class="legend-count" id="countNorth">‚Äî</div>
          </div>
        </div>
        <div class="legend-item active" data-region="east" onclick="toggleRegion('east', this)">
          <div class="legend-dot" style="background:var(--east)"></div>
          <div>
            <div class="legend-label">East</div>
            <div class="legend-count" id="countEast">‚Äî</div>
          </div>
        </div>
        <div class="legend-item active" data-region="south" onclick="toggleRegion('south', this)">
          <div class="legend-dot" style="background:var(--south)"></div>
          <div>
            <div class="legend-label">South</div>
            <div class="legend-count" id="countSouth">‚Äî</div>
          </div>
        </div>
        <div class="legend-item active" data-region="castle-rock" onclick="toggleRegion('castle-rock', this)">
          <div class="legend-dot" style="background:var(--castle-rock)"></div>
          <div>
            <div class="legend-label">Castle Rock</div>
            <div class="legend-count" id="countCastle-rock">‚Äî</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Distance Rings -->
    <div class="rings-legend">
      <div class="section-title">üìè Distance Rings from HQ</div>
      <div style="font-size:11px;color:var(--text-dim);margin-bottom:10px;">Ring color matches the region it passes through</div>
      <div class="rings-row">
        <span class="ring-chip">1 mi</span>
        <span class="ring-chip">3 mi</span>
        <span class="ring-chip">5 mi</span>
        <span class="ring-chip">10 mi</span>
        <span class="ring-chip">15 mi</span>
        <span class="ring-chip">20 mi</span>
      </div>
      <div style="display:flex;gap:4px;margin-top:10px;align-items:center;">
        <div style="flex:1;height:4px;border-radius:2px;background:linear-gradient(90deg, var(--north) 25%, var(--castle-rock) 25%, var(--castle-rock) 50%, var(--east) 50%, var(--east) 75%, var(--south) 75%);opacity:0.7;"></div>
        <span style="font-size:10px;color:var(--text-dim);white-space:nowrap;">by region</span>
      </div>
    </div>

    <!-- Intensity Key -->
    <div style="padding:16px 24px;border-bottom:1px solid var(--panel-border);">
      <div class="section-title">üîÜ Marker Intensity (darker = farther)</div>
      <div style="display:flex;gap:8px;margin-top:10px;align-items:center;">
        <div style="display:flex;align-items:center;gap:5px;">
          <div style="width:8px;height:8px;border-radius:50%;background:var(--text-dim);opacity:0.35;border:1.5px solid rgba(255,255,255,0.5);"></div>
          <span style="font-size:10px;color:var(--text-dim);">0‚Äì3 mi</span>
        </div>
        <div style="display:flex;align-items:center;gap:5px;">
          <div style="width:10px;height:10px;border-radius:50%;background:var(--text-dim);opacity:0.55;border:1.5px solid rgba(255,255,255,0.65);"></div>
          <span style="font-size:10px;color:var(--text-dim);">3‚Äì7 mi</span>
        </div>
        <div style="display:flex;align-items:center;gap:5px;">
          <div style="width:12px;height:12px;border-radius:50%;background:var(--text-dim);opacity:0.78;border:1.5px solid rgba(255,255,255,0.85);"></div>
          <span style="font-size:10px;color:var(--text-dim);">7‚Äì12 mi</span>
        </div>
        <div style="display:flex;align-items:center;gap:5px;">
          <div style="width:15px;height:15px;border-radius:50%;background:var(--text);opacity:1;border:1.5px solid rgba(255,255,255,0.85);box-shadow:0 0 6px var(--text-dim);"></div>
          <span style="font-size:10px;color:var(--text-dim);">12+ mi</span>
        </div>
      </div>
    </div>

    <!-- Neighborhoods -->
    <div class="neighborhoods-section">
      <div class="section-title">üèòÔ∏è Neighborhoods (<span id="nhoodCount">0</span>)</div>
      <input class="neighborhood-filter" type="text" placeholder="Filter neighborhoods..." oninput="filterNeighborhoods(this.value)">
      <div class="neighborhood-list" id="neighborhoodList"></div>
    </div>
  </div>
</aside>

<div class="map-container">
  <div id="map"></div>

  <div class="map-controls">
    <button class="map-ctrl-btn" onclick="map.zoomIn()" title="Zoom in">+</button>
    <button class="map-ctrl-btn" onclick="map.zoomOut()" title="Zoom out">‚àí</button>
    <button class="map-ctrl-btn" onclick="map.setView(HQ, 11)" title="Reset view">‚åÇ</button>
    <button class="map-ctrl-btn" id="toggleRings" onclick="toggleRingsVisibility()" title="Toggle distance rings">‚óé</button>
    <button class="map-ctrl-btn" id="toggleRegions" onclick="toggleRegionsVisibility()" title="Toggle regions">‚ñ¶</button>
  </div>

  <div class="stats-bar">
    <div class="stat-item">
      <div class="stat-value" id="statStops">0</div>
      <div class="stat-label">Stops</div>
    </div>
    <div class="stat-divider"></div>
    <div class="stat-item">
      <div class="stat-value" id="statRegions">‚Äî</div>
      <div class="stat-label">Regions</div>
    </div>
    <div class="stat-divider"></div>
    <div class="stat-item">
      <div class="stat-value" id="statFarthest">‚Äî</div>
      <div class="stat-label">Farthest</div>
    </div>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
      <div class="paw">üêæ</div>
      <p>Loading Woofies Route Planner...</p>
    </div>
  </div>
</div>

<script>
// ============== CONFIG ==============
const HQ = [39.3722, -104.8561]; // 201 S Wilcox St, Castle Rock
const MILE_TO_METERS = 1609.34;

const REGION_COLORS = {
  'north': { color: '#C62828', fill: 'rgba(198, 40, 40, 0.06)', border: 'rgba(198, 40, 40, 0.5)' },
  'east': { color: '#2E7D32', fill: 'rgba(46, 125, 50, 0.06)', border: 'rgba(46, 125, 50, 0.5)' },
  'south': { color: '#1565C0', fill: 'rgba(21, 101, 192, 0.06)', border: 'rgba(21, 101, 192, 0.5)' },
  'castle-rock': { color: '#D46A00', fill: 'rgba(180, 100, 0, 0.04)', border: 'rgba(180, 100, 0, 0.5)' }
};

// Distance rings in miles
const RINGS = [1, 3, 5, 10, 15, 20];

// ============== NEIGHBORHOODS (Exhaustive Douglas County + Elbert) ==============
const NEIGHBORHOODS = [
  // ==================== CASTLE ROCK (93) ====================
  // Downtown & Historic Core
  {name:"Castle Rock Downtown",lat:39.3742,lng:-104.8589,region:"castle-rock"},
  {name:"Craig & Gould",lat:39.3738,lng:-104.8608,region:"castle-rock"},
  {name:"Castle Rock Heights",lat:39.3760,lng:-104.8640,region:"castle-rock"},
  {name:"South Town",lat:39.3700,lng:-104.8580,region:"castle-rock"},
  {name:"Glover-Baldwin Park",lat:39.3710,lng:-104.8530,region:"castle-rock"},

  // Central & West
  {name:"Castle Highlands",lat:39.3690,lng:-104.8640,region:"castle-rock"},
  {name:"Red Hawk",lat:39.3810,lng:-104.8710,region:"castle-rock"},
  {name:"Sellars Gulch",lat:39.3770,lng:-104.8750,region:"castle-rock"},
  {name:"Keene Ranch",lat:39.3680,lng:-104.8780,region:"castle-rock"},
  {name:"Perry Park Village",lat:39.3680,lng:-104.8680,region:"castle-rock"},
  {name:"Crystal Valley Ranch",lat:39.3580,lng:-104.8730,region:"castle-rock"},
  {name:"Montaine",lat:39.3550,lng:-104.8810,region:"castle-rock"},
  {name:"Castle Rock Ranch Acres",lat:39.3600,lng:-104.8650,region:"castle-rock"},

  // South & Southeast
  {name:"Founders Village",lat:39.3680,lng:-104.8370,region:"castle-rock"},
  {name:"Castle Oaks",lat:39.3670,lng:-104.8480,region:"castle-rock"},
  {name:"Plum Creek",lat:39.3580,lng:-104.8560,region:"castle-rock"},
  {name:"Oakwood",lat:39.3580,lng:-104.8490,region:"castle-rock"},
  {name:"Dawson Trails",lat:39.3530,lng:-104.8540,region:"castle-rock"},
  {name:"Hidden Mesa",lat:39.3500,lng:-104.8620,region:"castle-rock"},
  {name:"Castle Rock Ranches",lat:39.3450,lng:-104.8480,region:"castle-rock"},
  {name:"Bell Mountain Ranch",lat:39.3440,lng:-104.8640,region:"castle-rock"},
  {name:"Stone Canon Ranch",lat:39.3400,lng:-104.8560,region:"castle-rock"},
  {name:"Baldwin Park",lat:39.3710,lng:-104.8460,region:"castle-rock"},
  {name:"Willow Creek",lat:39.3620,lng:-104.8420,region:"castle-rock"},
  {name:"Twin Oaks",lat:39.3560,lng:-104.8430,region:"castle-rock"},
  {name:"Kings Ridge",lat:39.3640,lng:-104.8380,region:"castle-rock"},
  {name:"Park Preserve",lat:39.3560,lng:-104.8620,region:"castle-rock"},
  {name:"Castle Ridge East",lat:39.3650,lng:-104.8330,region:"castle-rock"},
  {name:"Sellers Creek Ranch",lat:39.3510,lng:-104.8450,region:"castle-rock"},

  // North & Northeast
  {name:"Castlewood Ranch",lat:39.3850,lng:-104.8320,region:"castle-rock"},
  {name:"Terrain",lat:39.3950,lng:-104.8540,region:"castle-rock"},
  {name:"Sunstone Village",lat:39.3940,lng:-104.8510,region:"castle-rock"},
  {name:"Metzler Ranch",lat:39.3980,lng:-104.8460,region:"castle-rock"},
  {name:"Mesa",lat:39.3910,lng:-104.8600,region:"castle-rock"},
  {name:"Castle North",lat:39.3960,lng:-104.8620,region:"castle-rock"},
  {name:"Rhyolite",lat:39.3890,lng:-104.8700,region:"castle-rock"},
  {name:"Coachline",lat:39.3830,lng:-104.8520,region:"castle-rock"},
  {name:"Woodlands",lat:39.3850,lng:-104.8540,region:"castle-rock"},
  {name:"Miller's Landing",lat:39.3860,lng:-104.8410,region:"castle-rock"},
  {name:"Sapphire Pointe",lat:39.3765,lng:-104.8430,region:"castle-rock"},
  {name:"Diamond Ridge",lat:39.3930,lng:-104.8320,region:"castle-rock"},
  {name:"Canterberry Crossing",lat:39.3880,lng:-104.8370,region:"castle-rock"},
  {name:"Cobblestone Ranch",lat:39.3820,lng:-104.8260,region:"castle-rock"},
  {name:"Emerson Ranch",lat:39.3930,lng:-104.8300,region:"castle-rock"},
  {name:"Castle Park Ranch",lat:39.3900,lng:-104.8260,region:"castle-rock"},
  {name:"Timber Ridge",lat:39.3870,lng:-104.8300,region:"castle-rock"},
  {name:"Timber Canyon",lat:39.3890,lng:-104.8330,region:"castle-rock"},
  {name:"Pinon Soleil",lat:39.3940,lng:-104.8400,region:"castle-rock"},
  {name:"Siena",lat:39.3970,lng:-104.8380,region:"castle-rock"},
  {name:"The Haven",lat:39.3990,lng:-104.8520,region:"castle-rock"},
  {name:"Escavera",lat:39.3950,lng:-104.8480,region:"castle-rock"},
  {name:"Macanta",lat:39.4000,lng:-104.8440,region:"castle-rock"},
  {name:"Happy Canyon",lat:39.4020,lng:-104.8350,region:"castle-rock"},
  {name:"Cutters Ridge",lat:39.3910,lng:-104.8560,region:"castle-rock"},
  {name:"Latigo",lat:39.3880,lng:-104.8560,region:"castle-rock"},

  // Plum Creek sub-areas
  {name:"Plum Creek ‚Äî Highlands",lat:39.3560,lng:-104.8580,region:"castle-rock"},
  {name:"Plum Creek ‚Äî Peninsula",lat:39.3540,lng:-104.8520,region:"castle-rock"},
  {name:"Plum Creek ‚Äî Fairways",lat:39.3570,lng:-104.8500,region:"castle-rock"},
  {name:"Plum Creek ‚Äî Augusta Pt",lat:39.3590,lng:-104.8540,region:"castle-rock"},
  {name:"Plum Creek ‚Äî Ryder Cup",lat:39.3550,lng:-104.8570,region:"castle-rock"},
  {name:"Plum Creek ‚Äî Players Xing",lat:39.3600,lng:-104.8510,region:"castle-rock"},

  // THE MEADOWS ‚Äî 32 sub-neighborhoods (Wikipedia + HOA data)
  {name:"Meadows ‚Äî Alpine Ridge",lat:39.384,lng:-104.908,region:"castle-rock"},
  {name:"Meadows ‚Äî High Prairie",lat:39.386,lng:-104.902,region:"castle-rock"},
  {name:"Meadows ‚Äî Tyler Park",lat:39.396,lng:-104.896,region:"castle-rock"},
  {name:"Meadows ‚Äî New Haven",lat:39.394,lng:-104.893,region:"castle-rock"},
  {name:"Meadows ‚Äî Leafdale",lat:39.398,lng:-104.902,region:"castle-rock"},
  {name:"Meadows ‚Äî Gamble Oak",lat:39.397,lng:-104.906,region:"castle-rock"},
  {name:"Meadows ‚Äî Mountain View",lat:39.388,lng:-104.91,region:"castle-rock"},
  {name:"Meadows ‚Äî Meadow Gate",lat:39.39,lng:-104.905,region:"castle-rock"},
  {name:"Meadows ‚Äî Aspen Trail",lat:39.387,lng:-104.913,region:"castle-rock"},
  {name:"Meadows ‚Äî Coyote Run",lat:39.392,lng:-104.912,region:"castle-rock"},
  {name:"Meadows ‚Äî Vista Heights",lat:39.395,lng:-104.909,region:"castle-rock"},
  {name:"Meadows ‚Äî Deer Track",lat:39.383,lng:-104.897,region:"castle-rock"},
  {name:"Meadows ‚Äî Soaring Eagle",lat:39.385,lng:-104.892,region:"castle-rock"},
  {name:"Meadows ‚Äî Patina",lat:39.399,lng:-104.896,region:"castle-rock"},
  {name:"Meadows ‚Äî Watercolor",lat:39.401,lng:-104.903,region:"castle-rock"},
  {name:"Meadows ‚Äî Weathervane",lat:39.4,lng:-104.91,region:"castle-rock"},
  {name:"Meadows ‚Äî Suncatcher",lat:39.403,lng:-104.906,region:"castle-rock"},
  {name:"Meadows ‚Äî Plainsong",lat:39.402,lng:-104.899,region:"castle-rock"},
  {name:"Meadows ‚Äî Morgans Run",lat:39.398,lng:-104.91,region:"castle-rock"},
  {name:"Meadows ‚Äî Sweetwood",lat:39.4,lng:-104.89,region:"castle-rock"},
  {name:"Meadows ‚Äî Briscoe Ranch",lat:39.405,lng:-104.895,region:"castle-rock"},
  {name:"Meadows ‚Äî Morningview",lat:39.403,lng:-104.892,region:"castle-rock"},
  {name:"Meadows ‚Äî Feathergrass",lat:39.406,lng:-104.902,region:"castle-rock"},
  {name:"Meadows ‚Äî Harris Grove",lat:39.404,lng:-104.909,region:"castle-rock"},
  {name:"Meadows ‚Äî Fuller Bluff",lat:39.408,lng:-104.899,region:"castle-rock"},
  {name:"Meadows ‚Äî Upland Park",lat:39.409,lng:-104.906,region:"castle-rock"},
  {name:"Meadows ‚Äî Starling Hill",lat:39.407,lng:-104.91,region:"castle-rock"},
  {name:"Meadows ‚Äî Stewart Park",lat:39.405,lng:-104.905,region:"castle-rock"},
  {name:"Meadows ‚Äî Panorama",lat:39.41,lng:-104.903,region:"castle-rock"},
  {name:"Meadows ‚Äî Blacktail",lat:39.411,lng:-104.897,region:"castle-rock"},
  {name:"Meadows ‚Äî Azure",lat:39.393,lng:-104.9,region:"castle-rock"},
  {name:"Meadows ‚Äî Cyan Circle",lat:39.412,lng:-104.906,region:"castle-rock"},

  // ==================== NORTH ‚Äî HR, Castle Pines, Lone Tree (70) ====================
  {name:"HR ‚Äî Northridge",lat:39.5505,lng:-104.9690,region:"north"},
  {name:"HR ‚Äî Falcon Hills",lat:39.5480,lng:-104.9580,region:"north"},
  {name:"HR ‚Äî Richmond Pointe",lat:39.5430,lng:-104.9600,region:"north"},
  {name:"HR ‚Äî Timberline Ridge",lat:39.5460,lng:-104.9450,region:"north"},
  {name:"HR ‚Äî Sand Creek",lat:39.5490,lng:-104.9550,region:"north"},
  {name:"HR ‚Äî Writer Ridge",lat:39.5520,lng:-104.9620,region:"north"},
  {name:"HR ‚Äî Heather Hills",lat:39.5540,lng:-104.9500,region:"north"},
  {name:"HR ‚Äî Canyon Ranch",lat:39.5560,lng:-104.9650,region:"north"},
  {name:"HR ‚Äî Westridge",lat:39.5390,lng:-104.9820,region:"north"},
  {name:"HR ‚Äî Westridge Pointe",lat:39.5350,lng:-104.9850,region:"north"},
  {name:"HR ‚Äî Highland Hills",lat:39.5320,lng:-104.9780,region:"north"},
  {name:"HR ‚Äî The Villages",lat:39.5370,lng:-104.9900,region:"north"},
  {name:"HR ‚Äî Mansion Pointe",lat:39.5340,lng:-104.9880,region:"north"},
  {name:"HR ‚Äî Golf Club",lat:39.5300,lng:-104.9800,region:"north"},
  {name:"HR ‚Äî Westridge Glen",lat:39.5360,lng:-104.9760,region:"north"},
  {name:"HR ‚Äî Westridge Meadows",lat:39.5380,lng:-104.9730,region:"north"},
  {name:"HR ‚Äî Westridge Knolls",lat:39.5330,lng:-104.9840,region:"north"},
  {name:"HR ‚Äî Mansion Hills",lat:39.5310,lng:-104.9860,region:"north"},
  {name:"HR ‚Äî Eastridge",lat:39.5480,lng:-104.9410,region:"north"},
  {name:"HR ‚Äî Palomino Park",lat:39.5510,lng:-104.9350,region:"north"},
  {name:"HR ‚Äî The Links",lat:39.5450,lng:-104.9320,region:"north"},
  {name:"HR ‚Äî Hawks Point",lat:39.5470,lng:-104.9280,region:"north"},
  {name:"HR ‚Äî Eastridge Terrace",lat:39.5440,lng:-104.9380,region:"north"},
  {name:"HR ‚Äî Southridge",lat:39.5230,lng:-104.9670,region:"north"},
  {name:"HR ‚Äî Dad Clark",lat:39.5350,lng:-104.9520,region:"north"},
  {name:"HR ‚Äî Indigo Hill",lat:39.5260,lng:-104.9700,region:"north"},
  {name:"HR ‚Äî Kentley Hills",lat:39.5280,lng:-104.9640,region:"north"},
  {name:"HR ‚Äî The Hearth",lat:39.5310,lng:-104.9580,region:"north"},
  {name:"HR ‚Äî Verona",lat:39.5250,lng:-104.9540,region:"north"},
  {name:"HR ‚Äî Rock Canyon",lat:39.5200,lng:-104.9620,region:"north"},
  {name:"HR ‚Äî Sundance",lat:39.5240,lng:-104.9590,region:"north"},
  {name:"HR ‚Äî Stonebury",lat:39.5270,lng:-104.9730,region:"north"},
  {name:"HR ‚Äî Southridge Vista",lat:39.5220,lng:-104.9560,region:"north"},
  {name:"HR ‚Äî Town Center",lat:39.5520,lng:-104.9530,region:"north"},
  {name:"HR ‚Äî Mountain Vista",lat:39.5420,lng:-104.9390,region:"north"},
  {name:"HR ‚Äî Firelight",lat:39.5290,lng:-104.9710,region:"north"},
  {name:"HR ‚Äî Ranch Reserve",lat:39.5160,lng:-104.9460,region:"north"},
  {name:"HR ‚Äî Backcountry",lat:39.5190,lng:-104.9180,region:"north"},
  {name:"HR ‚Äî Highlands Pt",lat:39.5440,lng:-104.9750,region:"north"},
  {name:"HR ‚Äî Highwoods",lat:39.5210,lng:-104.9500,region:"north"},
  {name:"HR ‚Äî Birkdale",lat:39.5400,lng:-104.9680,region:"north"},
  {name:"HR ‚Äî Huntington Est.",lat:39.5500,lng:-104.9480,region:"north"},
  {name:"HR ‚Äî Clocktower",lat:39.5530,lng:-104.9560,region:"north"},
  {name:"HR ‚Äî Carlyle Park",lat:39.5470,lng:-104.9640,region:"north"},
  {name:"HR ‚Äî Weatherstone",lat:39.5420,lng:-104.9560,region:"north"},
  {name:"Lone Tree",lat:39.5186,lng:-104.8963,region:"north"},
  {name:"Lone Tree ‚Äî RidgeGate",lat:39.5090,lng:-104.8890,region:"north"},
  {name:"Lone Tree ‚Äî Heritage",lat:39.5250,lng:-104.8760,region:"north"},
  {name:"Park Meadows",lat:39.5610,lng:-104.8810,region:"north"},
  {name:"Castle Pines",lat:39.4620,lng:-104.8960,region:"north"},
  {name:"Castle Pines Village",lat:39.4700,lng:-104.9100,region:"north"},
  {name:"Castle Pines North",lat:39.4750,lng:-104.8850,region:"north"},
  {name:"Surrey Ridge",lat:39.4730,lng:-104.8670,region:"north"},
  {name:"The Canyons",lat:39.4560,lng:-104.8530,region:"north"},
  {name:"Wildcat Ridge",lat:39.4590,lng:-104.9120,region:"north"},
  {name:"Lagae Ranch",lat:39.4650,lng:-104.8810,region:"north"},
  {name:"Sedalia",lat:39.4380,lng:-104.9570,region:"north"},
  {name:"Daniels Park",lat:39.4670,lng:-104.9230,region:"north"},
  {name:"Roxborough",lat:39.4700,lng:-105.0710,region:"north"},
  {name:"Roxborough Village",lat:39.4890,lng:-105.0640,region:"north"},
  {name:"Roxborough Park",lat:39.4750,lng:-105.0750,region:"north"},
  {name:"Sterling Ranch",lat:39.4810,lng:-105.0380,region:"north"},
  {name:"Waterton",lat:39.4840,lng:-105.0530,region:"north"},
  {name:"Chatfield Area",lat:39.5340,lng:-105.0690,region:"north"},
  {name:"Acres Green",lat:39.5410,lng:-104.8970,region:"north"},
  {name:"Inverness",lat:39.5670,lng:-104.8570,region:"north"},
  {name:"Lincoln Station",lat:39.5490,lng:-104.8690,region:"north"},
  {name:"Stonegate",lat:39.5410,lng:-104.8430,region:"north"},
  {name:"Meridian",lat:39.5220,lng:-104.8530,region:"north"},

  // ==================== EAST ‚Äî Parker, Pinery, Rural (70) ====================
  {name:"Parker ‚Äî Downtown",lat:39.5123,lng:-104.7614,region:"east"},
  {name:"Parker ‚Äî Clarke Farms",lat:39.5100,lng:-104.7730,region:"east"},
  {name:"Parker ‚Äî Stonegate N",lat:39.5320,lng:-104.7480,region:"east"},
  {name:"Parker ‚Äî Stonegate S",lat:39.5250,lng:-104.7450,region:"east"},
  {name:"Parker ‚Äî Timbers",lat:39.5200,lng:-104.7830,region:"east"},
  {name:"Parker ‚Äî Lincoln Creek",lat:39.5050,lng:-104.7590,region:"east"},
  {name:"Parker ‚Äî Stroh Ranch",lat:39.5010,lng:-104.7380,region:"east"},
  {name:"Parker ‚Äî Pine Lane",lat:39.5190,lng:-104.7190,region:"east"},
  {name:"Parker ‚Äî Canterberry",lat:39.5140,lng:-104.7990,region:"east"},
  {name:"Parker ‚Äî Idyllwilde",lat:39.5300,lng:-104.7340,region:"east"},
  {name:"Parker ‚Äî Motsenbocker",lat:39.5060,lng:-104.7690,region:"east"},
  {name:"Parker ‚Äî Ponderosa",lat:39.4970,lng:-104.7560,region:"east"},
  {name:"Parker ‚Äî Bar CK Ranch",lat:39.4930,lng:-104.7390,region:"east"},
  {name:"Parker ‚Äî Sierra Ridge",lat:39.4880,lng:-104.7520,region:"east"},
  {name:"Parker ‚Äî Challenger Est.",lat:39.5280,lng:-104.7100,region:"east"},
  {name:"Parker ‚Äî Heirloom",lat:39.5070,lng:-104.7800,region:"east"},
  {name:"Parker ‚Äî Bradbury Ranch",lat:39.5160,lng:-104.7650,region:"east"},
  {name:"Parker ‚Äî Rowley Downs",lat:39.5080,lng:-104.7540,region:"east"},
  {name:"Parker ‚Äî Cottonwood",lat:39.5340,lng:-104.7600,region:"east"},
  {name:"Parker ‚Äî Dove Ridge",lat:39.5370,lng:-104.7550,region:"east"},
  {name:"Parker ‚Äî Auburn Hills",lat:39.5130,lng:-104.7500,region:"east"},
  {name:"Parker ‚Äî Newlin Meadows",lat:39.5020,lng:-104.7470,region:"east"},
  {name:"Parker ‚Äî Hidden River",lat:39.5050,lng:-104.7850,region:"east"},
  {name:"Parker ‚Äî Saddlebrook",lat:39.4990,lng:-104.7650,region:"east"},
  {name:"Parker ‚Äî Willow Park",lat:39.5120,lng:-104.7420,region:"east"},
  {name:"Parker ‚Äî Bell Cross",lat:39.5180,lng:-104.7300,region:"east"},
  {name:"Parker ‚Äî Sunset Ridge",lat:39.5060,lng:-104.7350,region:"east"},
  {name:"Parker ‚Äî Parker Vista",lat:39.5150,lng:-104.7550,region:"east"},
  {name:"Parker ‚Äî Antelope Hts",lat:39.5040,lng:-104.7300,region:"east"},
  {name:"Parker ‚Äî Horse Creek",lat:39.5090,lng:-104.7260,region:"east"},
  {name:"Parker ‚Äî Horseshoe Rdg",lat:39.5110,lng:-104.7220,region:"east"},
  {name:"Parker ‚Äî Pine Bluffs",lat:39.5030,lng:-104.7410,region:"east"},
  {name:"Parker ‚Äî Anthology",lat:39.4990,lng:-104.7520,region:"east"},
  {name:"Parker ‚Äî Stepping Stone",lat:39.5210,lng:-104.7590,region:"east"},
  {name:"Parker ‚Äî Villages of Pkr",lat:39.5100,lng:-104.8020,region:"east"},
  {name:"Parker ‚Äî Dove Village",lat:39.5380,lng:-104.7490,region:"east"},
  {name:"Parker ‚Äî Jordan Crossing",lat:39.5350,lng:-104.7680,region:"east"},
  {name:"Parker ‚Äî Meridian Vlg",lat:39.5290,lng:-104.7640,region:"east"},
  {name:"Parker ‚Äî Spirit Ridge",lat:39.5200,lng:-104.7460,region:"east"},
  {name:"Parker ‚Äî Stonecreek Rch",lat:39.4940,lng:-104.7450,region:"east"},
  {name:"Parker ‚Äî Reata Ridge",lat:39.4950,lng:-104.7290,region:"east"},
  {name:"Parker ‚Äî Preston Hills",lat:39.5170,lng:-104.7700,region:"east"},
  {name:"Parker ‚Äî Salisbury Hts",lat:39.5100,lng:-104.7150,region:"east"},
  {name:"Parker ‚Äî Meadowlark",lat:39.5350,lng:-104.7430,region:"east"},
  {name:"Parker ‚Äî Quail Creek",lat:39.5230,lng:-104.7360,region:"east"},
  {name:"Parker ‚Äî Butterfield",lat:39.4960,lng:-104.7370,region:"east"},
  {name:"Parker ‚Äî Tenderfoot",lat:39.5070,lng:-104.7430,region:"east"},
  {name:"Parker ‚Äî Travois",lat:39.5030,lng:-104.7580,region:"east"},
  {name:"Pinery",lat:39.4530,lng:-104.7370,region:"east"},
  {name:"Pinery ‚Äî West",lat:39.4570,lng:-104.7560,region:"east"},
  {name:"Pinery ‚Äî East",lat:39.4490,lng:-104.7190,region:"east"},
  {name:"Pinery ‚Äî Timbers",lat:39.4550,lng:-104.7450,region:"east"},
  {name:"Pinery ‚Äî Glen",lat:39.4510,lng:-104.7510,region:"east"},
  {name:"Bayou Gulch",lat:39.4680,lng:-104.7680,region:"east"},
  {name:"Lincoln Park",lat:39.4720,lng:-104.7490,region:"east"},
  {name:"Paintbrush",lat:39.4850,lng:-104.7310,region:"east"},
  {name:"Prairie Hawk",lat:39.4400,lng:-104.7280,region:"east"},
  {name:"Pradera",lat:39.4240,lng:-104.7570,region:"east"},
  {name:"Hidden River Estates",lat:39.4430,lng:-104.7650,region:"east"},
  {name:"Colorado Golf Club",lat:39.4350,lng:-104.7490,region:"east"},
  {name:"High Prairie Farms",lat:39.4470,lng:-104.7580,region:"east"},
  {name:"Franktown",lat:39.3880,lng:-104.7450,region:"east"},
  {name:"Russellville Estates",lat:39.3750,lng:-104.7300,region:"east"},
  {name:"Cherry Valley",lat:39.4100,lng:-104.7380,region:"east"},
  {name:"Castlewood Canyon",lat:39.3330,lng:-104.7450,region:"east"},
  {name:"Elizabeth",lat:39.3611,lng:-104.5974,region:"east"},
  {name:"Running Creek",lat:39.3550,lng:-104.6200,region:"east"},
  {name:"Spring Valley Ranch",lat:39.3450,lng:-104.6100,region:"east"},
  {name:"Kiowa",lat:39.3450,lng:-104.4630,region:"east"},
  {name:"Elbert",lat:39.2260,lng:-104.5480,region:"east"},

  // ==================== SOUTH (28) ====================
  {name:"Larkspur",lat:39.2220,lng:-104.8820,region:"south"},
  {name:"Larkspur Butte",lat:39.2190,lng:-104.8960,region:"south"},
  {name:"Perry Park",lat:39.2580,lng:-104.9120,region:"south"},
  {name:"Bear Creek Village",lat:39.2400,lng:-104.8950,region:"south"},
  {name:"Bear Creek Estates",lat:39.2460,lng:-104.8840,region:"south"},
  {name:"Spruce Mtn Estates",lat:39.2750,lng:-104.8930,region:"south"},
  {name:"Spruce Mountain",lat:39.2800,lng:-104.9000,region:"south"},
  {name:"Spring Valley",lat:39.2150,lng:-104.8700,region:"south"},
  {name:"Greenland",lat:39.2350,lng:-104.8620,region:"south"},
  {name:"Greenland Ranch",lat:39.2500,lng:-104.8540,region:"south"},
  {name:"Tomah Road Area",lat:39.3030,lng:-104.8910,region:"south"},
  {name:"Castle Pines South",lat:39.3130,lng:-104.8780,region:"south"},
  {name:"Rainbow Falls",lat:39.3100,lng:-104.8500,region:"south"},
  {name:"Sage Port",lat:39.2900,lng:-104.8650,region:"south"},
  {name:"Dawson Ridge",lat:39.2700,lng:-104.8560,region:"south"},
  {name:"Red Rock Ranch",lat:39.2600,lng:-104.8700,region:"south"},
  {name:"Pine Bluffs",lat:39.2300,lng:-104.8500,region:"south"},
  {name:"Palmer Lake",lat:39.1220,lng:-104.9170,region:"south"},
  {name:"Monument",lat:39.0917,lng:-104.8727,region:"south"},
  {name:"Monument ‚Äî Tri-Lakes",lat:39.1080,lng:-104.8860,region:"south"},
  {name:"Monument ‚Äî Jackson Crk",lat:39.0750,lng:-104.8420,region:"south"},
  {name:"Monument ‚Äî Promontory",lat:39.0810,lng:-104.8580,region:"south"},
  {name:"Monument ‚Äî Fox Run",lat:39.0850,lng:-104.8320,region:"south"},
  {name:"Woodmoor",lat:39.1050,lng:-104.8540,region:"south"},
  {name:"Lake Woodmoor",lat:39.1100,lng:-104.8700,region:"south"},
  {name:"Gleneagle",lat:39.0410,lng:-104.8230,region:"south"},
  {name:"Forest Lakes",lat:39.1000,lng:-104.9050,region:"south"},
  {name:"Red Mountain Ranch",lat:39.1150,lng:-104.8950,region:"south"},
];

// ============== NEIGHBORHOOD POLYGON BOUNDARIES ==============
// Each polygon is an array of [lat, lng] vertices forming a closed boundary.
// rect(n, s, w, e) helper defines rectangular boundaries.
// Refine with actual GIS/subdivision data for production precision.
function rect(n, s, w, e) { return [[n,w],[n,e],[s,e],[s,w]]; }

const NEIGHBORHOOD_BOUNDS = {
  // ---- CASTLE ROCK CORE (Yellow) ----
  // North tier (39.393 ‚Äì 39.403)
  "Castle North":          rect(39.403, 39.393, -104.905, -104.860),
  "Terrain":               rect(39.403, 39.393, -104.860, -104.850),
  "Mesa":                  rect(39.403, 39.393, -104.850, -104.840),
  "Metzler Ranch":         rect(39.403, 39.393, -104.840, -104.825),
  "Emerson Ranch":         rect(39.403, 39.393, -104.825, -104.810),
  "Diamond Ridge":         rect(39.398, 39.388, -104.838, -104.822),

  // Upper-mid tier (39.385 ‚Äì 39.393)
  "Rhyolite":              rect(39.393, 39.385, -104.905, -104.873),
  "Red Hawk":              rect(39.393, 39.378, -104.873, -104.862),
  "Coachline":             rect(39.385, 39.378, -104.862, -104.850),
  "Woodlands at CR":       rect(39.385, 39.378, -104.850, -104.840),
  "The Meadows":           rect(39.415, 39.380, -104.915, -104.885),
  "Canterberry Crossing":  rect(39.393, 39.385, -104.840, -104.825),
  "Miller's Landing":      rect(39.393, 39.385, -104.845, -104.840),
  "Castlewood Ranch":      rect(39.393, 39.378, -104.825, -104.810),
  "Cobblestone Ranch":     rect(39.385, 39.378, -104.830, -104.810),

  // Central tier ‚Äî DOWNTOWN CORE (39.370 ‚Äì 39.378)
  // Lewis St runs N-S at approx lng -104.8607, inside Craig & Gould
  "Sellars Gulch":         rect(39.380, 39.370, -104.905, -104.873),
  "Craig & Gould":         rect(39.378, 39.370, -104.873, -104.856),
  "Castle Rock Downtown":  rect(39.378, 39.370, -104.856, -104.845),
  "Sapphire Pointe":       rect(39.378, 39.370, -104.845, -104.835),
  "Founders Village":      rect(39.378, 39.363, -104.835, -104.810),

  // South-central tier (39.360 ‚Äì 39.370)
  "Perry Park Village (CR)": rect(39.373, 39.363, -104.905, -104.873),
  "Keene Ranch":           rect(39.370, 39.360, -104.905, -104.873),
  "Crystal Valley Ranch":  rect(39.363, 39.350, -104.905, -104.873),
  "Castle Oaks":           rect(39.370, 39.363, -104.873, -104.856),
  "Castle Rock Ranch Acres": rect(39.370, 39.363, -104.856, -104.845),
  "Plum Creek":            rect(39.363, 39.355, -104.873, -104.856),
  "Oakwood":               rect(39.363, 39.355, -104.856, -104.835),

  // South tier (39.338 ‚Äì 39.355)
  "Montaine":              rect(39.355, 39.345, -104.905, -104.873),
  "Hidden Mesa":           rect(39.355, 39.345, -104.873, -104.855),
  "Dawson Trails":         rect(39.355, 39.345, -104.855, -104.835),
  "Castle Rock Ranches":   rect(39.345, 39.338, -104.905, -104.835),

  // ---- NORTH REGION (Red) ----
  // Highlands Ranch
  "Highlands Ranch ‚Äî Town Center":    rect(39.558, 39.548, -104.965, -104.940),
  "Highlands Ranch ‚Äî Northridge":     rect(39.558, 39.546, -104.980, -104.965),
  "Highlands Ranch ‚Äî Highlands Point":rect(39.550, 39.540, -104.985, -104.970),
  "Highlands Ranch ‚Äî Westridge":      rect(39.546, 39.533, -104.995, -104.975),
  "Highlands Ranch ‚Äî Eastridge":      rect(39.556, 39.543, -104.950, -104.930),
  "Highlands Ranch ‚Äî Mountain Vista": rect(39.548, 39.538, -104.945, -104.930),
  "Highlands Ranch ‚Äî Dad Clark":      rect(39.542, 39.530, -104.960, -104.942),
  "Highlands Ranch ‚Äî Firelight":      rect(39.535, 39.524, -104.980, -104.963),
  "Highlands Ranch ‚Äî Southridge":     rect(39.530, 39.518, -104.975, -104.958),
  "Highlands Ranch ‚Äî Falcon Hills":   rect(39.525, 39.512, -104.968, -104.948),
  "Highlands Ranch ‚Äî Ranch Reserve":  rect(39.522, 39.510, -104.955, -104.935),
  "Highlands Ranch ‚Äî Backcountry":    rect(39.527, 39.512, -104.930, -104.905),

  // Lone Tree / Park Meadows
  "Park Meadows Area":        rect(39.570, 39.555, -104.895, -104.870),
  "Inverness":                rect(39.575, 39.560, -104.870, -104.845),
  "Lincoln Station Area":     rect(39.558, 39.543, -104.880, -104.858),
  "Lone Tree":                rect(39.528, 39.512, -104.908, -104.887),
  "Lone Tree ‚Äî RidgeGate":   rect(39.516, 39.502, -104.900, -104.878),
  "Lone Tree ‚Äî Heritage Hills": rect(39.532, 39.520, -104.885, -104.865),
  "Acres Green":              rect(39.548, 39.535, -104.908, -104.887),
  "Stonegate":                rect(39.550, 39.535, -104.855, -104.832),
  "Meridian":                 rect(39.530, 39.515, -104.865, -104.842),

  // Castle Pines area
  "Castle Pines":             rect(39.470, 39.455, -104.910, -104.885),
  "Castle Pines Village":     rect(39.480, 39.465, -104.925, -104.900),
  "Castle Pines North":       rect(39.485, 39.470, -104.898, -104.875),
  "Wildcat Ridge":            rect(39.468, 39.453, -104.925, -104.900),
  "Happy Canyon":             rect(39.463, 39.447, -104.885, -104.862),
  "Surrey Ridge":             rect(39.482, 39.468, -104.878, -104.855),
  "The Canyons":              rect(39.463, 39.448, -104.862, -104.842),
  "Daniels Park Area":        rect(39.478, 39.460, -104.935, -104.910),
  "Sedalia":                  rect(39.448, 39.428, -104.970, -104.940),

  // Roxborough / Sterling Ranch
  "Roxborough":               rect(39.480, 39.462, -105.085, -105.060),
  "Roxborough Village":       rect(39.498, 39.482, -105.078, -105.050),
  "Roxborough Park":          rect(39.483, 39.468, -105.090, -105.065),
  "Sterling Ranch":           rect(39.492, 39.474, -105.050, -105.025),
  "Waterton":                 rect(39.495, 39.478, -105.065, -105.042),
  "Chatfield Area":           rect(39.545, 39.525, -105.082, -105.055),

  // ---- EAST REGION (Green) ----
  // Parker
  "Parker ‚Äî Town Center":     rect(39.520, 39.507, -104.772, -104.750),
  "Parker ‚Äî Stonegate":       rect(39.540, 39.526, -104.758, -104.737),
  "Parker ‚Äî Timbers":         rect(39.528, 39.514, -104.793, -104.773),
  "Parker ‚Äî Lincoln Creek":   rect(39.512, 39.498, -104.770, -104.748),
  "Parker ‚Äî Stroh Ranch":     rect(39.510, 39.494, -104.748, -104.727),
  "Parker ‚Äî Pine Lane Estates": rect(39.527, 39.513, -104.730, -104.707),
  "Parker ‚Äî Canterberry":     rect(39.522, 39.508, -104.810, -104.790),
  "Parker ‚Äî Idyllwilde":      rect(39.538, 39.524, -104.744, -104.723),
  "Parker ‚Äî Motsenbocker":    rect(39.514, 39.500, -104.780, -104.758),
  "Parker ‚Äî Ponderosa":       rect(39.505, 39.490, -104.767, -104.745),
  "Parker ‚Äî Bar CK Ranch":    rect(39.502, 39.486, -104.750, -104.728),
  "Parker ‚Äî Sierra Ridge":    rect(39.496, 39.480, -104.763, -104.742),
  "Parker ‚Äî Challenge Estates": rect(39.536, 39.522, -104.722, -104.698),
  "Parker ‚Äî Heirloom":        rect(39.515, 39.500, -104.790, -104.770),

  // Pinery / south Parker
  "Pinery":                   rect(39.462, 39.445, -104.748, -104.725),
  "Pinery ‚Äî West":            rect(39.465, 39.450, -104.768, -104.748),
  "Pinery ‚Äî East":            rect(39.458, 39.440, -104.730, -104.707),
  "Bayou Gulch":              rect(39.478, 39.460, -104.780, -104.756),
  "Lincoln Park":             rect(39.480, 39.465, -104.760, -104.738),
  "Paintbrush":               rect(39.493, 39.478, -104.742, -104.720),
  "Hidden River Estates":     rect(39.452, 39.435, -104.778, -104.752),
  "Prairie Hawk":             rect(39.448, 39.432, -104.740, -104.716),
  "Pradera":                  rect(39.432, 39.416, -104.770, -104.745),

  // Franktown / Cherry Valley
  "Franktown":                rect(39.398, 39.378, -104.760, -104.730),
  "Russellville Estates":     rect(39.383, 39.367, -104.742, -104.718),
  "Cherry Valley":            rect(39.420, 39.400, -104.750, -104.725),

  // Elizabeth / Elbert County
  "Castlewood Canyon Area":   rect(39.345, 39.320, -104.760, -104.730),
  "Elizabeth":                 rect(39.372, 39.350, -104.615, -104.580),
  "Running Creek":             rect(39.365, 39.345, -104.635, -104.605),
  "Spring Valley Ranch":       rect(39.355, 39.335, -104.625, -104.595),
  "Kiowa":                     rect(39.358, 39.332, -104.480, -104.445),
  "Elbert":                    rect(39.240, 39.215, -104.565, -104.530),
  "Simla":                     rect(39.155, 39.132, -104.098, -104.065),
  "Agate":                     rect(39.135, 39.108, -104.098, -104.065),
  "Deer Trail (Elbert Co.)":   rect(39.625, 39.600, -104.398, -104.365),

  // ---- SOUTH REGION (Blue) ----
  "Tomah Road Area":           rect(39.315, 39.295, -104.905, -104.878),
  "Castle Pines South":        rect(39.322, 39.305, -104.892, -104.865),
  "Rainbow Falls":             rect(39.320, 39.300, -104.862, -104.838),
  "Sage Port":                 rect(39.300, 39.280, -104.878, -104.852),
  "Spruce Mountain":           rect(39.290, 39.272, -104.915, -104.888),
  "Spruce Mountain Estates":   rect(39.285, 39.268, -104.905, -104.880),
  "Dawson Ridge":              rect(39.280, 39.262, -104.868, -104.842),
  "Red Rock Ranch":            rect(39.270, 39.252, -104.882, -104.858),
  "Perry Park":                rect(39.268, 39.248, -104.925, -104.898),
  "Bear Creek Estates":        rect(39.255, 39.238, -104.895, -104.872),
  "Bear Creek Village":        rect(39.250, 39.232, -104.908, -104.882),
  "Greenland Ranch":           rect(39.260, 39.242, -104.868, -104.840),
  "Greenland":                 rect(39.245, 39.225, -104.875, -104.848),
  "Pine Bluffs":               rect(39.240, 39.220, -104.862, -104.838),
  "Larkspur":                  rect(39.232, 39.212, -104.895, -104.870),
  "Larkspur Butte":            rect(39.228, 39.210, -104.910, -104.885),
  "Spring Valley":             rect(39.225, 39.205, -104.882, -104.858),
  "Palmer Lake":               rect(39.132, 39.112, -104.930, -104.905),
  "Monument":                  rect(39.102, 39.082, -104.886, -104.858),
  "Monument ‚Äî Tri-Lakes":     rect(39.118, 39.098, -104.900, -104.873),
  "Monument ‚Äî Jackson Creek": rect(39.085, 39.065, -104.856, -104.828),
  "Monument ‚Äî Promontory Pointe": rect(39.092, 39.072, -104.872, -104.845),
  "Woodmoor":                  rect(39.116, 39.096, -104.868, -104.840),
  "Lake Woodmoor":             rect(39.120, 39.100, -104.882, -104.858),
  "Gleneagle":                 rect(39.052, 39.030, -104.838, -104.810),

  // ---- ADDITIONAL CASTLE ROCK ----
  "Sellers Creek Ranch":       rect(39.358, 39.345, -104.855, -104.835),
  "Castle Highlands":          rect(39.375, 39.363, -104.873, -104.856),
  "South Town":                rect(39.373, 39.365, -104.865, -104.845),
  "Castle Rock Heights":       rect(39.380, 39.373, -104.873, -104.856),
  "Glover-Baldwin Park":       rect(39.375, 39.367, -104.860, -104.845),
  "Baldwin Park":              rect(39.375, 39.367, -104.852, -104.838),
  "Willow Creek":              rect(39.368, 39.355, -104.850, -104.832),
  "Twin Oaks":                 rect(39.362, 39.350, -104.850, -104.832),
  "Kings Ridge":               rect(39.370, 39.360, -104.845, -104.828),
  "Stone Canon Ranch":         rect(39.348, 39.332, -104.868, -104.845),
  "Bell Mountain Ranch":       rect(39.352, 39.338, -104.875, -104.855),
  "Cutters Ridge":             rect(39.395, 39.388, -104.862, -104.848),
  "Latigo":                    rect(39.392, 39.385, -104.862, -104.848),
  "Macanta":                   rect(39.407, 39.395, -104.852, -104.835),
  "The Haven":                 rect(39.405, 39.395, -104.860, -104.845),
  "Escavera":                  rect(39.400, 39.390, -104.855, -104.840),
  "Siena":                     rect(39.403, 39.393, -104.845, -104.830),
  "Pinon Soleil":              rect(39.400, 39.390, -104.845, -104.830),
  "Happy Canyon":              rect(39.410, 39.398, -104.842, -104.825),
  "Castle Park Ranch":         rect(39.395, 39.385, -104.835, -104.815),
  "Timber Ridge":              rect(39.392, 39.382, -104.838, -104.822),
  "Timber Canyon":             rect(39.394, 39.384, -104.840, -104.825),
  "Castle Ridge East":         rect(39.370, 39.360, -104.840, -104.820),

  // ---- ADDITIONAL NORTH / HR ----
  "HR ‚Äî Canyon Ranch":         rect(39.562, 39.553, -104.972, -104.958),
  "HR ‚Äî Westridge Glen":       rect(39.542, 39.530, -104.983, -104.968),
  "HR ‚Äî Westridge Meadows":    rect(39.544, 39.533, -104.980, -104.965),
  "HR ‚Äî Westridge Knolls":     rect(39.540, 39.528, -104.990, -104.978),
  "HR ‚Äî Mansion Hills":        rect(39.537, 39.525, -104.993, -104.980),
  "HR ‚Äî Sundance":             rect(39.530, 39.518, -104.966, -104.952),
  "HR ‚Äî Stonebury":            rect(39.533, 39.522, -104.980, -104.966),
  "HR ‚Äî Southridge Vista":     rect(39.528, 39.516, -104.963, -104.948),
  "HR ‚Äî Highwoods":            rect(39.527, 39.515, -104.958, -104.942),
  "HR ‚Äî Birkdale":             rect(39.546, 39.535, -104.975, -104.960),
  "HR ‚Äî Huntington Est.":      rect(39.556, 39.545, -104.955, -104.940),
  "HR ‚Äî Clocktower":           rect(39.559, 39.549, -104.963, -104.948),
  "HR ‚Äî Carlyle Park":         rect(39.553, 39.543, -104.972, -104.957),
  "HR ‚Äî Weatherstone":         rect(39.548, 39.538, -104.963, -104.948),
  "Lagae Ranch":               rect(39.472, 39.458, -104.892, -104.870),

  // ---- ADDITIONAL EAST / PARKER ----
  "Parker ‚Äî Antelope Hts":     rect(39.512, 39.497, -104.740, -104.720),
  "Parker ‚Äî Horse Creek":      rect(39.516, 39.503, -104.736, -104.716),
  "Parker ‚Äî Horseshoe Rdg":    rect(39.518, 39.505, -104.732, -104.712),
  "Parker ‚Äî Pine Bluffs":      rect(39.510, 39.496, -104.751, -104.731),
  "Parker ‚Äî Anthology":        rect(39.506, 39.492, -104.762, -104.742),
  "Parker ‚Äî Stepping Stone":   rect(39.528, 39.515, -104.768, -104.750),
  "Parker ‚Äî Villages of Pkr":  rect(39.518, 39.504, -104.812, -104.792),
  "Parker ‚Äî Dove Village":     rect(39.545, 39.532, -104.758, -104.740),
  "Parker ‚Äî Jordan Crossing":  rect(39.542, 39.528, -104.778, -104.758),
  "Parker ‚Äî Meridian Village": rect(39.536, 39.522, -104.774, -104.754),
  "Parker ‚Äî Spirit Ridge":     rect(39.528, 39.514, -104.756, -104.736),
  "Parker ‚Äî Stonecreek Ranch": rect(39.502, 39.488, -104.755, -104.735),
  "Parker ‚Äî Reata Ridge":      rect(39.502, 39.488, -104.740, -104.718),
  "Parker ‚Äî Preston Hills":    rect(39.524, 39.510, -104.780, -104.760),
  "Parker ‚Äî Salisbury Hts":    rect(39.518, 39.504, -104.725, -104.705),
  "Parker ‚Äî Meadowlark":       rect(39.542, 39.528, -104.752, -104.733),
  "Parker ‚Äî Quail Creek":      rect(39.530, 39.516, -104.745, -104.726),
  "Parker ‚Äî Butterfield":      rect(39.504, 39.489, -104.747, -104.727),
  "Parker ‚Äî Tenderfoot":       rect(39.514, 39.500, -104.753, -104.733),
  "Parker ‚Äî Travois":          rect(39.510, 39.496, -104.768, -104.748),
  "Pinery ‚Äî Glen":             rect(39.460, 39.443, -104.762, -104.740),
  "Colorado Golf Club":        rect(39.443, 39.427, -104.760, -104.738),
  "High Prairie Farms":        rect(39.455, 39.440, -104.768, -104.748),

  // ---- ADDITIONAL SOUTH ----
  "Forest Lakes":              rect(39.110, 39.090, -104.918, -104.892),
  "Red Mountain Ranch":        rect(39.125, 39.105, -104.908, -104.882),
  "Monument ‚Äî Fox Run":       rect(39.095, 39.078, -104.845, -104.820),
};

// ============== POINT-IN-POLYGON ==============
function pointInPolygon(lat, lng, polygon) {
  let inside = false;
  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
    const yi = polygon[i][0], xi = polygon[i][1];
    const yj = polygon[j][0], xj = polygon[j][1];
    const intersect = ((yi > lat) !== (yj > lat)) &&
      (lng < (xj - xi) * (lat - yi) / (yj - yi) + xi);
    if (intersect) inside = !inside;
  }
  return inside;
}

// ============== REGION BOUNDARY POLYGONS ==============
const REGION_POLYGONS = {
  'castle-rock': [
    [39.4030, -104.9050], [39.4030, -104.8100],
    [39.3380, -104.8100], [39.3380, -104.9050]
  ],
  'north': [
    [39.5800, -105.1000], [39.5800, -104.7500],
    [39.4030, -104.7500], [39.4030, -104.8100],
    [39.4030, -104.9050], [39.4030, -105.1000]
  ],
  'east': [
    [39.5800, -104.7500], [39.5800, -104.3000],
    [39.1000, -104.3000], [39.1000, -104.7500],
    [39.3380, -104.7500], [39.3380, -104.8100],
    [39.4030, -104.8100], [39.4030, -104.7500]
  ],
  'south': [
    [39.3380, -104.9050], [39.3380, -104.8100],
    [39.3380, -104.7500], [39.1000, -104.7500],
    [39.0000, -104.7500], [39.0000, -105.1000],
    [39.4030, -105.1000], [39.4030, -104.9050]
  ]
};

// ============== GLOBALS ==============
let map, regionLayers = {}, ringLayers = [], neighborhoodMarkers = [];
let routeStops = [];
let ringsVisible = true, regionsVisible = true;

// ============== MAP INIT ==============
function initMap() {
  map = L.map('map', {
    center: HQ,
    zoom: 11,
    zoomControl: false,
    attributionControl: true
  });

  // Light tile layer with clear labels
  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap &copy; CARTO',
    maxZoom: 19
  }).addTo(map);

  // Draw regions
  Object.keys(REGION_POLYGONS).forEach(region => {
    const poly = L.polygon(REGION_POLYGONS[region], {
      color: REGION_COLORS[region].border,
      fillColor: REGION_COLORS[region].fill,
      fillOpacity: 1,
      weight: 2,
      dashArray: '6, 4'
    }).addTo(map);
    regionLayers[region] = poly;

    // Region label
    const center = poly.getBounds().getCenter();
    const label = L.divIcon({
      className: '',
      html: `<div style="color:${REGION_COLORS[region].color};font-family:Fredoka,sans-serif;font-size:14px;font-weight:700;text-shadow:0 1px 3px rgba(255,255,255,0.9), 0 0 8px rgba(255,255,255,0.7);white-space:nowrap;letter-spacing:0.5px;text-transform:uppercase;background:rgba(255,255,255,0.6);padding:2px 8px;border-radius:4px;">${region === 'castle-rock' ? 'Castle Rock' : region.charAt(0).toUpperCase() + region.slice(1)}</div>`,
      iconSize: [0, 0]
    });
    L.marker(center, { icon: label, interactive: false }).addTo(map);
  });

  // Draw distance rings with region-matched colors
  RINGS.forEach((miles, i) => {
    const weight = 2 + (i * 0.3);
    const opacity = 0.5 + (i * 0.08);
    const dashArray = i === 0 ? '' : '8, 6';

    // Generate points around the full circle
    const points = [];
    for (let deg = 0; deg <= 360; deg += 1) {
      const pt = destinationPoint(HQ[0], HQ[1], miles, deg);
      points.push({ lat: pt[0], lng: pt[1], bearing: deg });
    }

    // Group consecutive points by region and draw colored segments
    let currentRegion = determineRegion(points[0].lat, points[0].lng);
    let segment = [[points[0].lat, points[0].lng]];

    for (let p = 1; p < points.length; p++) {
      const region = determineRegion(points[p].lat, points[p].lng);
      if (region !== currentRegion) {
        // Close and draw current segment
        segment.push([points[p].lat, points[p].lng]);
        const color = REGION_COLORS[currentRegion] ? REGION_COLORS[currentRegion].color : '#888';
        const line = L.polyline(segment, {
          color: color,
          weight: weight,
          opacity: opacity,
          dashArray: dashArray,
          lineCap: 'round'
        }).addTo(map);
        ringLayers.push(line);
        // Start new segment
        currentRegion = region;
        segment = [[points[p].lat, points[p].lng]];
      } else {
        segment.push([points[p].lat, points[p].lng]);
      }
    }
    // Draw final segment
    if (segment.length > 1) {
      const color = REGION_COLORS[currentRegion] ? REGION_COLORS[currentRegion].color : '#888';
      const line = L.polyline(segment, {
        color: color,
        weight: weight,
        opacity: opacity,
        dashArray: dashArray,
        lineCap: 'round'
      }).addTo(map);
      ringLayers.push(line);
    }

    // Ring label at north
    const labelPt = destinationPoint(HQ[0], HQ[1], miles, 0);
    const labelColor = REGION_COLORS[determineRegion(labelPt[0], labelPt[1])]?.color || '#e94560';
    const ringLabel = L.divIcon({
      className: '',
      html: `<div style="color:${labelColor};font-size:11px;font-weight:700;text-shadow:0 1px 3px rgba(0,0,0,0.9);font-family:DM Sans,sans-serif;background:rgba(22,33,62,0.85);padding:2px 6px;border-radius:4px;border:1px solid ${labelColor}44;">${miles} mi</div>`,
      iconSize: [40, 16],
      iconAnchor: [20, 8]
    });
    const labelMarker = L.marker(labelPt, { icon: ringLabel, interactive: false }).addTo(map);
    ringLayers.push(labelMarker);
  });

  // HQ Marker
  const hqIcon = L.divIcon({
    className: '',
    html: `<div style="position:relative;">
      <div style="width:24px;height:24px;background:#d4830a;border:3px solid #fff;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,0.3),0 0 20px rgba(212,131,10,0.4);"></div>
      <div style="position:absolute;top:-34px;left:50%;transform:translateX(-50%);white-space:nowrap;background:#fff;padding:5px 12px;border-radius:6px;font-family:Fredoka,sans-serif;font-size:12px;color:#d4830a;border:1px solid #e0e3e8;box-shadow:0 2px 8px rgba(0,0,0,0.1);font-weight:600;">üêæ Woofies HQ</div>
    </div>`,
    iconSize: [24, 24],
    iconAnchor: [12, 12]
  });
  L.marker(HQ, { icon: hqIcon }).addTo(map)
    .bindPopup(`<div class="popup-title">üêæ Woofies HQ</div><div>201 S. Wilcox St<br>Castle Rock, CO 80104</div>`);

  // Plot neighborhoods
  plotNeighborhoods();
  buildNeighborhoodList();
  updateCounts();

  // Hide loading
  setTimeout(() => {
    document.getElementById('loadingOverlay').classList.add('hidden');
  }, 800);
}

// ============== DISTANCE INTENSITY ==============
// Returns opacity, size, glow for distance tier (darker/bolder = farther)
function getDistanceTier(dist) {
  if (dist <= 3)  return { tier: 'core', opacity: 0.75, size: 10, glow: 0,  label: '0‚Äì3 mi' };
  if (dist <= 7)  return { tier: 'near', opacity: 0.85, size: 12, glow: 0,  label: '3‚Äì7 mi' };
  if (dist <= 12) return { tier: 'mid',  opacity: 0.92, size: 13, glow: 4,  label: '7‚Äì12 mi' };
  return                  { tier: 'far',  opacity: 1.0,  size: 15, glow: 8,  label: '12+ mi' };
}

// Blend a hex color toward darker by a factor (0 = original, 1 = black)
function darkenColor(hex, factor) {
  const r = parseInt(hex.slice(1,3), 16);
  const g = parseInt(hex.slice(3,5), 16);
  const b = parseInt(hex.slice(5,7), 16);
  const dr = Math.round(r * (1 - factor));
  const dg = Math.round(g * (1 - factor));
  const db = Math.round(b * (1 - factor));
  return `rgb(${dr},${dg},${db})`;
}

// ============== NEIGHBORHOODS ==============
function plotNeighborhoods() {
  NEIGHBORHOODS.forEach(n => {
    const dist = getDistance(HQ[0], HQ[1], n.lat, n.lng);
    n.distance = dist;

    const baseColor = REGION_COLORS[n.region].color;
    const tier = getDistanceTier(dist);
    // Darken factor: core=0 (lightest), far=0.35 (darkest)
    const darkenFactor = tier.tier === 'core' ? 0.10 : tier.tier === 'near' ? 0.20 : tier.tier === 'mid' ? 0.32 : 0.45;
    const markerColor = darkenColor(baseColor, darkenFactor);
    const glowStr = tier.glow > 0 ? `,0 0 ${tier.glow}px ${markerColor}` : '';

    const icon = L.divIcon({
      className: '',
      html: `<div style="width:${tier.size}px;height:${tier.size}px;background:${markerColor};border:2.5px solid rgba(255,255,255,0.95);border-radius:50%;opacity:${tier.opacity};box-shadow:0 1px 4px rgba(0,0,0,0.4)${glowStr};"></div>`,
      iconSize: [tier.size, tier.size],
      iconAnchor: [tier.size/2, tier.size/2]
    });

    const marker = L.marker([n.lat, n.lng], { icon: icon }).addTo(map);
    marker.bindPopup(`
      <div class="popup-title">${n.name}</div>
      <div class="popup-region" style="background:${baseColor}22;color:${baseColor}">${formatRegion(n.region)}</div>
      <div class="popup-dist">${dist.toFixed(1)} miles from HQ ¬∑ <span style="opacity:0.7">${tier.label}</span></div>
      <button class="popup-add-btn" onclick="addStop('${n.name}', ${n.lat}, ${n.lng}, '${n.region}')">+ Add to Route</button>
    `);

    marker.nhoodData = n;
    neighborhoodMarkers.push(marker);
  });
}

function buildNeighborhoodList() {
  const sorted = [...NEIGHBORHOODS].sort((a, b) => a.distance - b.distance);
  const list = document.getElementById('neighborhoodList');
  document.getElementById('nhoodCount').textContent = sorted.length;

  list.innerHTML = sorted.map(n => {
    const baseColor = REGION_COLORS[n.region].color;
    const tier = getDistanceTier(n.distance);
    const darkenFactor = tier.tier === 'core' ? 0 : tier.tier === 'near' ? 0.12 : tier.tier === 'mid' ? 0.25 : 0.38;
    const dotColor = darkenColor(baseColor, darkenFactor);
    // Background bar: intensity increases with distance
    const barOpacity = tier.tier === 'core' ? 0.06 : tier.tier === 'near' ? 0.10 : tier.tier === 'mid' ? 0.16 : 0.22;
    return `<div class="neighborhood-item" onclick="flyToNeighborhood(${n.lat}, ${n.lng})" data-region="${n.region}" data-name="${n.name.toLowerCase()}" style="background:${baseColor}${Math.round(barOpacity*255).toString(16).padStart(2,'0')};">
      <div class="neighborhood-dot" style="background:${dotColor};width:${tier.size - 2}px;height:${tier.size - 2}px;"></div>
      <div class="neighborhood-name">${n.name}</div>
      <div class="neighborhood-dist">${n.distance.toFixed(1)} mi</div>
    </div>`;
  }).join('');
}

function filterNeighborhoods(query) {
  const items = document.querySelectorAll('.neighborhood-item');
  const q = query.toLowerCase();
  let count = 0;
  items.forEach(item => {
    const match = item.dataset.name.includes(q);
    item.style.display = match ? '' : 'none';
    if (match) count++;
  });
  document.getElementById('nhoodCount').textContent = count;
}

function flyToNeighborhood(lat, lng) {
  map.flyTo([lat, lng], 14, { duration: 0.8 });
  // Find and open popup
  neighborhoodMarkers.forEach(m => {
    if (m.nhoodData.lat === lat && m.nhoodData.lng === lng) {
      setTimeout(() => m.openPopup(), 300);
    }
  });
}

// ============== GOOGLE GEOCODING API ==============
const GOOGLE_API_KEY = 'AIzaSyCYHFmYwJH5lKL9wrhI-B8dms3G2rN9e5g';  // üëà Replace with your key

async function geocodeGoogle(address) {
  try {
    const url = `https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(address)}&key=${GOOGLE_API_KEY}`;
    const resp = await fetch(url);
    const data = await resp.json();
    
    if (data.status === 'OK' && data.results.length > 0) {
      const result = data.results[0];
      return {
        lat: result.geometry.location.lat,
        lng: result.geometry.location.lng,
        address: result.formatted_address,
        source: 'Google'
      };
    } else if (data.status === 'ZERO_RESULTS') {
      return null;
    } else {
      console.error('Google Geocoding error:', data.status);
      return null;
    }
  } catch(e) {
    console.error('Google Geocoding API failed:', e);
    return null;
  }
}

async function lookupAddress() {
  const input = document.getElementById('addressInput').value.trim();
  if (!input) return;

  const card = document.getElementById('resultCard');
  card.className = 'result-card';
  card.style.display = 'none';

  const query = input.includes('CO') || input.includes('Colorado') ? input : input + ', Colorado';

  card.className = 'result-card show';
  card.style.display = 'block';
  card.style.background = 'rgba(245, 197, 66, 0.1)';
  card.style.border = '1px solid rgba(245, 197, 66, 0.2)';
  document.getElementById('resultRegion').textContent = 'Searching...';
  document.getElementById('resultRegion').style.color = 'var(--paw)';
  document.getElementById('resultDetail').textContent = '';

  try {
    const geo = await geocodeGoogle(query);

    if (!geo) {
      card.className = 'result-card show';
      card.style.display = 'block';
      card.style.background = 'rgba(233, 69, 96, 0.15)';
      card.style.border = '1px solid rgba(233, 69, 96, 0.3)';
      document.getElementById('resultRegion').textContent = 'Address Not Found';
      document.getElementById('resultRegion').style.color = 'var(--accent)';
      document.getElementById('resultDetail').textContent = 'Try: "123 Main St, Parker" or "Founders Village"';
      return;
    }

    const lat = geo.lat;
    const lng = geo.lng;
    const formattedAddr = geo.address;
    const dist = getDistance(HQ[0], HQ[1], lat, lng);
    const region = determineRegion(lat, lng);
    const regionName = formatRegion(region);
    const color = REGION_COLORS[region] ? REGION_COLORS[region].color : '#888';

    card.className = `result-card show ${region}`;
    document.getElementById('resultRegion').textContent = `${regionName} Region`;
    document.getElementById('resultDetail').innerHTML = `
      üìç ${formattedAddr}<br>
      üìè ${dist.toFixed(1)} miles from HQ<br>
      üïê ~${Math.round(dist * 2.5)} min drive estimate
    `;

    const searchIcon = L.divIcon({
      className: '',
      html: `<div style="width:16px;height:16px;background:${color};border:3px solid #fff;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,0.5);"></div>`,
      iconSize: [16, 16],
      iconAnchor: [8, 8]
    });

    const marker = L.marker([lat, lng], { icon: searchIcon }).addTo(map);
    marker.bindPopup(`
      <div class="popup-title">Searched Address</div>
      <div class="popup-region" style="background:${color}22;color:${color}">${regionName}</div>
      <div style="font-size:12px;margin:4px 0">${formattedAddr}</div>
      <div class="popup-dist">${dist.toFixed(1)} miles from HQ</div>
      <button class="popup-add-btn" onclick="addStop('${input.replace(/'/g, "\\'")}', ${lat}, ${lng}, '${region}')">+ Add to Route</button>
    `).openPopup();

    map.flyTo([lat, lng], 14, { duration: 0.8 });

  } catch (e) {
    console.error('Address lookup failed:', e);
    card.className = 'result-card show';
    card.style.display = 'block';
    card.style.background = 'rgba(233, 69, 96, 0.15)';
    card.style.border = '1px solid rgba(233, 69, 96, 0.3)';
    document.getElementById('resultRegion').textContent = 'Error';
    document.getElementById('resultRegion').style.color = 'var(--accent)';
    document.getElementById('resultDetail').textContent = 'Network error. Check connection and API key.';
  }
}

// ============== ROUTE STOPS ==============
function addStop(name, lat, lng, region) {
  if (routeStops.length >= 15) { alert('Max 15 stops per route'); return; }
  const dist = getDistance(HQ[0], HQ[1], lat, lng);
  routeStops.push({ name, lat, lng, region, distance: dist });
  renderStops();
  map.closePopup();
}

function removeStop(index) {
  routeStops.splice(index, 1);
  renderStops();
}

function clearStops() {
  routeStops = [];
  renderStops();
}

function renderStops() {
  const list = document.getElementById('stopsList');
  const noStops = document.getElementById('noStops');
  const clearBtn = document.getElementById('clearBtn');

  if (routeStops.length === 0) {
    list.innerHTML = '<div class="no-stops">Click neighborhoods or search addresses to build a route</div>';
    clearBtn.style.display = 'none';
    document.getElementById('statStops').textContent = '0';
    document.getElementById('statRegions').textContent = '‚Äî';
    document.getElementById('statFarthest').textContent = '‚Äî';
    return;
  }

  clearBtn.style.display = 'block';

  list.innerHTML = routeStops.map((s, i) => {
    const baseColor = REGION_COLORS[s.region] ? REGION_COLORS[s.region].color : '#888';
    const tier = getDistanceTier(s.distance);
    const darkenFactor = tier.tier === 'core' ? 0 : tier.tier === 'near' ? 0.12 : tier.tier === 'mid' ? 0.25 : 0.38;
    const stopColor = darkenColor(baseColor, darkenFactor);
    return `<div class="stop-item">
      <div class="stop-num" style="background:${stopColor}">${i + 1}</div>
      <div class="stop-info">
        <div>${s.name}</div>
        <div class="stop-addr">${s.distance.toFixed(1)} mi ¬∑ ${formatRegion(s.region)} ¬∑ ${tier.label}</div>
      </div>
      <button class="stop-remove" onclick="removeStop(${i})">‚úï</button>
    </div>`;
  }).join('');

  // Stats
  document.getElementById('statStops').textContent = routeStops.length;
  const regions = [...new Set(routeStops.map(s => s.region))];
  document.getElementById('statRegions').textContent = regions.length;
  const farthest = Math.max(...routeStops.map(s => s.distance));
  document.getElementById('statFarthest').textContent = farthest.toFixed(1) + 'mi';
}

// ============== TOGGLE CONTROLS ==============
function toggleRegion(region, el) {
  el.classList.toggle('active');
  if (regionLayers[region]) {
    if (el.classList.contains('active')) {
      map.addLayer(regionLayers[region]);
    } else {
      map.removeLayer(regionLayers[region]);
    }
  }
  // Toggle neighborhood markers
  neighborhoodMarkers.forEach(m => {
    if (m.nhoodData.region === region) {
      if (el.classList.contains('active')) {
        map.addLayer(m);
      } else {
        map.removeLayer(m);
      }
    }
  });
}

function toggleRingsVisibility() {
  ringsVisible = !ringsVisible;
  document.getElementById('toggleRings').classList.toggle('active', ringsVisible);
  ringLayers.forEach(r => {
    if (ringsVisible) map.addLayer(r); else map.removeLayer(r);
  });
}

function toggleRegionsVisibility() {
  regionsVisible = !regionsVisible;
  document.getElementById('toggleRegions').classList.toggle('active', regionsVisible);
  Object.values(regionLayers).forEach(l => {
    if (regionsVisible) map.addLayer(l); else map.removeLayer(l);
  });
}

// ============== UTILITIES ==============
function getDistance(lat1, lon1, lat2, lon2) {
  const R = 3958.8; // Earth radius in miles
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat / 2) ** 2 + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) ** 2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

function findNearestNeighborhood(lat, lng) {
  // 1. Check polygon containment first (proper fix)
  for (const n of NEIGHBORHOODS) {
    const bounds = NEIGHBORHOOD_BOUNDS[n.name];
    if (bounds && pointInPolygon(lat, lng, bounds)) {
      const d = getDistance(lat, lng, n.lat, n.lng);
      return { name: n.name, region: n.region, dist: d, method: 'polygon' };
    }
  }
  // 2. Fallback to nearest center point if no polygon match
  let closest = null;
  let minDist = Infinity;
  NEIGHBORHOODS.forEach(n => {
    const d = getDistance(lat, lng, n.lat, n.lng);
    if (d < minDist) {
      minDist = d;
      closest = n;
    }
  });
  return closest ? { name: closest.name, region: closest.region, dist: minDist, method: 'nearest' } : null;
}

function determineRegion(lat, lng) {
  // Castle Rock box
  if (lat >= 39.338 && lat <= 39.403 && lng >= -104.905 && lng <= -104.810) return 'castle-rock';
  // North
  if (lat > 39.403 && lng < -104.750) return 'north';
  // East (Parker, Franktown, Elbert County)
  if (lng >= -104.810 && lat > 39.338) return 'east';
  if (lng >= -104.750 && lat <= 39.338) return 'east';
  // South
  if (lat <= 39.338) return 'south';
  return 'castle-rock';
}

function formatRegion(r) {
  if (r === 'castle-rock') return 'Castle Rock';
  return r.charAt(0).toUpperCase() + r.slice(1);
}

// Calculate destination point given start, distance (miles), and bearing (degrees)
function destinationPoint(lat1, lon1, distMiles, bearingDeg) {
  const R = 3958.8;
  const d = distMiles / R;
  const brng = bearingDeg * Math.PI / 180;
  const lat1r = lat1 * Math.PI / 180;
  const lon1r = lon1 * Math.PI / 180;
  const lat2 = Math.asin(Math.sin(lat1r) * Math.cos(d) + Math.cos(lat1r) * Math.sin(d) * Math.cos(brng));
  const lon2 = lon1r + Math.atan2(Math.sin(brng) * Math.sin(d) * Math.cos(lat1r), Math.cos(d) - Math.sin(lat1r) * Math.sin(lat2));
  return [lat2 * 180 / Math.PI, lon2 * 180 / Math.PI];
}

function updateCounts() {
  const counts = { north: 0, east: 0, south: 0, 'castle-rock': 0 };
  NEIGHBORHOODS.forEach(n => counts[n.region]++);
  Object.keys(counts).forEach(r => {
    const el = document.getElementById('count' + r.charAt(0).toUpperCase() + r.slice(1));
    if (el) el.textContent = counts[r] + ' areas';
  });
}

// ============== INIT ==============
document.addEventListener('DOMContentLoaded', initMap);
// Set initial toggle states
setTimeout(() => {
  document.getElementById('toggleRings').classList.add('active');
  document.getElementById('toggleRegions').classList.add('active');
}, 100);
</script>
<script>
function initAutocomplete() {
  const input = document.getElementById("addressInput");
  if (!input || !window.google || !window.google.maps) {
    setTimeout(initAutocomplete, 500);
    return;
  }
  const autocomplete = new google.maps.places.Autocomplete(input, {
    componentRestrictions: { country: "us" },
    bounds: { south: 39.0, west: -105.3, north: 39.8, east: -104.3 },
    types: ["address"]
  });
  autocomplete.addListener("place_changed", () => {
    const place = autocomplete.getPlace();
    if (place.geometry) { setTimeout(lookupAddress, 100); }
  });
}
window.addEventListener("load", () => setTimeout(initAutocomplete, 1000));
</script>
</script><script></body>
</html>
